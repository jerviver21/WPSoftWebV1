
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:p="http://primefaces.org/ui"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets">
<f:view>
<ui:composition template="../plantilla1.xhtml">
    <ui:define name="navegador">
        <ui:include src="../menu.xhtml"/>
    </ui:define>
    <ui:define name="contenido">
        <h:form id="form" >
            <p:growl id="msgs" />
            
            <p:separator/>
            <h4>Información General</h4>
            <h:panelGrid columns="2">
                <h:outputLabel value="Id del Permiso:"/>
                <h:outputText value="#{gestionPermisoController.permiso.permiso.id}"/>
                <h:outputLabel value="Actividad del Permiso:"/>
                <h:outputText value="#{gestionPermisoController.permiso.permiso.tarea}"/>
                <h:outputLabel value="#{gestionPermisoController.tarea.consecutivo} - Paso a realizar:" style="font-weight: bold"/>
                <h:outputText value="#{gestionPermisoController.tarea.datos}" style="font-weight: bold"/>
            </h:panelGrid>
            
            <p:separator/>
            <h4>Peligros</h4>
            <h:panelGrid columns="2">
                <p:selectOneMenu id="peligro" value="#{gestionPermisoController.peligro.id}" effect="fold">
                    <f:selectItems  value="#{gestionPermisoController.peligros}" />
                    <p:ajax update="@form"/>
                </p:selectOneMenu>
                <p:commandButton icon="ui-icon-plus" value="Agregar" actionListener="#{gestionPermisoController.agregarPeligro}" update="@form"/>
            </h:panelGrid>
            
            <p:separator/>
            <p:fieldset id="peligros_seleccionados" legend="Peligros que podrían presentarse" style="margin-top:20px">  
                <p:outputPanel id="peligros_paso">  
                    <h:outputText value="Agregue los peligros que se pueden presntar al ejecutar el paso: #{gestionPermisoController.tarea.datos}!" 
                                  rendered="#{empty gestionPermisoController.tarea.peligros}" />  
                    <p:dataTable var="peligro" value="#{gestionPermisoController.tarea.peligros}"
                                 rendered="#{not empty gestionPermisoController.tarea.peligros}">  
                        <p:column style="width:4%">  
                            <p:rowToggler />  
                        </p:column> 
                        <p:column headerText="Peligro">  
                            <h:outputText value="#{peligro.peligro.nombre}" />  
                        </p:column>  
                        <p:column headerText="Borrar">  
                            <p:commandButton icon="ui-icon-trash" actionListener="#{gestionPermisoController.borrarPeligro(peligro)}" update="@form"/> 
                        </p:column> 
                        
                        <p:rowExpansion>  
                            <p:tabView id="tabView">  
                                <p:tab id="tab1" title="Controles">  
                                    <p:panelGrid columns="3">
                                        <h:outputLabel value="Control:"/>
                                        <p:inputText value="#{gestionPermisoController.control}"/>
                                        <p:commandButton icon="ui-icon-cart" actionListener="#{gestionPermisoController.agregarControl(peligro)}"/>
                                    </p:panelGrid>
                                    
                                    <p:dataTable value="#{peligro.controles}" var="control">
                                        <f:facet name="header">
                                            
                                        </f:facet>
                                        <p:column headerText="Control">
                                            <h:outputText value="#{control.control}"/>
                                        </p:column>
                                        <p:column headerText="Borrar">
                                            <p:commandButton icon="ui-icon-trash" actionListener="#{gestionPermisoController.borrarControl(peligro,control)}"/>
                                        </p:column>
                                    </p:dataTable> 
                                </p:tab>  

                                <p:tab id="tab2" title="Riesgos">  
                                    <h:panelGrid columns="2" cellpadding="10">  
                                        <h:outputText id="tab2Text" value="Los riesgos"/>  
                                    </h:panelGrid>  
                                </p:tab>  
                            </p:tabView>  
                        </p:rowExpansion>  
                        
                        
                    </p:dataTable>  
                </p:outputPanel> 
                <f:facet name="footer">
                    <p:commandButton value="Guardar" icon="ui-icon-disk" action="#{gestionPermisoController.guardarRiesgo}" ajax="false"/>
                </f:facet>
            </p:fieldset>  


            

            

        </h:form>
   </ui:define>
  </ui:composition>
</f:view>
</html>

