
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:p="http://primefaces.org/ui"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets">
<f:view>
<ui:composition template="#{applicationController.plantilla}">
    <ui:define name="navegador">
        <ui:include src="../menu.xhtml"/>
    </ui:define>
    <ui:define name="contenido">
        <h:form id="form" >
            <p:growl id="msgs" />
            
            <p:separator/>
            <h4>Información General</h4>
            <h:panelGrid columns="2">
                <h:outputLabel value="Id del Permiso:"/>
                <h:outputText value="#{gestionPermisoController.permiso.id}"/>
                <h:outputLabel value="Actividad del Permiso:"/>
                <h:outputText value="#{gestionPermisoController.permiso.tarea}"/>
                <h:outputLabel value="#{gestionPermisoController.tarea.consecutivo} - Paso a realizar:" style="font-weight: bold"/>
                <h:outputText value="#{gestionPermisoController.tarea.datos}" style="font-weight: bold"/>
            </h:panelGrid>
            
            <p:separator/>
            <h4>Peligros</h4>
            <h:panelGrid columns="2">
                <h:selectOneMenu id="peligro" value="#{gestionPermisoController.peligro.id}" effect="fold">
                    <f:selectItems  value="#{gestionPermisoController.peligros}" />
                    <p:ajax update="@form"/>
                </h:selectOneMenu>
                <p:commandButton icon="ui-icon-plus" value="Agregar" actionListener="#{gestionPermisoController.agregarPeligro}" update="@form"/>
            </h:panelGrid>
            
            
            <p:fieldset id="peligros_seleccionados" legend="Peligros que podrían presentarse" style="margin-top:20px">  
                <p:outputPanel id="peligros_paso">  
                    <h:outputText value="Agregue los peligros que se pueden presntar al ejecutar el paso: #{gestionPermisoController.tarea.datos}!" 
                                  rendered="#{empty gestionPermisoController.tarea.peligros}" />  
                    <p:dataTable var="peligro" value="#{gestionPermisoController.tarea.peligros}"
                                 rendered="#{not empty gestionPermisoController.tarea.peligros}">  
                        <p:column style="width:4%">  
                            <p:rowToggler />  
                        </p:column> 
                        <p:column headerText="Peligro">  
                            <h:outputText value="#{peligro.peligro.nombre}" />  
                        </p:column>  
                        <p:column headerText="Borrar">  
                            <p:commandButton icon="ui-icon-trash" actionListener="#{gestionPermisoController.borrarPeligro(peligro)}" update="@form"/> 
                        </p:column> 
                        
                        <p:rowExpansion id="expansion">  
                            <p:tabView id="ptab">  
                                <p:tab id="tab1" title="Controles">  
                                    <p:commandButton type="button" onclick="dlg_control.show();" icon="ui-icon-plus" value="Agregar"/>
                                    <p:dataTable id="controles" value="#{peligro.controles}" var="control">
                                        <p:column headerText="Control">
                                            <h:outputText value="#{control.control}"/>
                                        </p:column>
                                        <p:column headerText="Borrar">
                                            <p:commandButton icon="ui-icon-trash" 
                                                             actionListener="#{gestionPermisoController.borrarControl(peligro,control)}"
                                                             update="controles"/>
                                        </p:column>
                                    </p:dataTable> 
                                </p:tab>  

                                <p:tab id="tab2" title="Riesgos">  
                                    <p:commandButton type="button" onclick="dlg_riesgo.show();" icon="ui-icon-plus" value="Agregar"/>
                                    <p:dataTable id="riesgos" value="#{peligro.riesgos}" var="riesgo">
                                        <p:column headerText="Riesgo">
                                            <h:outputText value="#{riesgo.nombre}"/>
                                        </p:column>
                                        <p:column headerText="Borrar">
                                            <p:commandButton icon="ui-icon-trash" 
                                                             actionListener="#{gestionPermisoController.borrarRiesgo(peligro,riesgo)}"
                                                             update="riesgos"/>
                                        </p:column>
                                    </p:dataTable> 
                                </p:tab>  
                            </p:tabView>  
                            <p:dialog id="control" widgetVar="dlg_control" modal="true" width="350" height="100" appendToBody="true">
                                <p:panelGrid columns="2">
                                    <f:facet name="header">
                                        <h:outputText value="Datos del Control"/>
                                    </f:facet>
                                    <h:outputLabel value="Control:"/>
                                    <p:inputText value="#{gestionPermisoController.control}"/>
                                    <f:facet name="footer">
                                        <p:commandButton icon="ui-icon-disk" value="Guardar" oncomplete="dlg_control.hide()" 
                                                         actionListener="#{gestionPermisoController.agregarControl(peligro)}" update="ptab"/>
                                    </f:facet>
                                </p:panelGrid>
                            </p:dialog>
                            <p:dialog id="riesgo" widgetVar="dlg_riesgo" width="350" height="100" appendToBody="true">
                                <p:panelGrid columns="2">
                                    <f:facet name="header">
                                        <h:outputText value="Datos del Riesgo"/>
                                    </f:facet>
                                    <h:outputLabel value="Riesgo:"/>
                                    <p:inputText value="#{gestionPermisoController.riesgo}"/>
                                    <f:facet name="footer">
                                        <p:commandButton icon="ui-icon-disk" value="Guardar" oncomplete="dlg_riesgo.hide()" 
                                                         actionListener="#{gestionPermisoController.agregarRiesgo(peligro)}" update="ptab"/>
                                    </f:facet>
                                </p:panelGrid>
                            </p:dialog>
                        </p:rowExpansion>   
                        
                        
                        
                    </p:dataTable>  
                </p:outputPanel> 
            </p:fieldset>  
            
            <p:separator/>
            
            <p:commandButton value="Guardar" icon="ui-icon-disk" action="#{gestionPermisoController.guardarGestionTareas}" ajax="false"/>
            
            
            
            

            

        </h:form>
   </ui:define>
  </ui:composition>
</f:view>
</html>

